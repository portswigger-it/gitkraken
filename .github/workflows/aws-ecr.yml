name: Deploy to Amazon ECR

on:
  workflow_dispatch

env:
  AWS_REGION: eu-west-1
  ECR_REPOSITORY: gitkraken-server

permissions:
  contents: read

jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest
    environment: production

    steps:
    - name: Checkout
      uses: actions/checkout@v3

    - name: Download and unzip latest release
      run: |
        wget -q -O temp.zip https://release.gitkraken.com/enterprise/GitKrakenEnterpriseServer.zip
        unzip temp.zip
        rm temp.zip
    
    - name: List all the files
      run: ls -l
